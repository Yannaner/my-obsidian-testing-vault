/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var O=Object.create;var E=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var q=(l,t)=>{for(var e in t)E(l,e,{get:t[e],enumerable:!0})},I=(l,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of j(t))!_.call(l,s)&&s!==e&&E(l,s,{get:()=>t[s],enumerable:!(i=B(t,s))||i.enumerable});return l};var z=(l,t,e)=>(e=l!=null?O(M(l)):{},I(t||!l||!l.__esModule?E(e,"default",{value:l,enumerable:!0}):e,l)),J=l=>I(E({},"__esModule",{value:!0}),l);var K={};q(K,{default:()=>T});module.exports=J(K);var p=require("obsidian");var g=require("obsidian"),F={githubRepoUrl:"",deployedUrl:"",enableGitPublish:!0,autoSyncOnSave:!1},C=class extends g.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"VaultSite Settings"}),new g.Setting(t).setName("GitHub Repository URL").setDesc("The URL of your GitHub repository (e.g., https://github.com/username/repo)").addText(e=>e.setPlaceholder("https://github.com/username/repo").setValue(this.plugin.settings.githubRepoUrl).onChange(async i=>{this.plugin.settings.githubRepoUrl=i,await this.plugin.saveSettings()})),new g.Setting(t).setName("Deployed Website URL").setDesc("The URL where your site is deployed (e.g., https://yoursite.vercel.app)").addText(e=>e.setPlaceholder("https://yoursite.vercel.app").setValue(this.plugin.settings.deployedUrl).onChange(async i=>{this.plugin.settings.deployedUrl=i,await this.plugin.saveSettings()})),this.plugin.settings.deployedUrl&&new g.Setting(t).setName("Open Website").setDesc("Open your deployed website in a browser").addButton(e=>e.setButtonText("Open").setCta().onClick(()=>{window.open(this.plugin.settings.deployedUrl,"_blank")})),new g.Setting(t).setName("Enable Git Publish").setDesc("Allow the Publish command to run git add, commit, and push").addToggle(e=>e.setValue(this.plugin.settings.enableGitPublish).onChange(async i=>{this.plugin.settings.enableGitPublish=i,await this.plugin.saveSettings()})),new g.Setting(t).setName("Auto Sync on Save").setDesc("Automatically sync notes when you save a file (experimental)").addToggle(e=>e.setValue(this.plugin.settings.autoSyncOnSave).onChange(async i=>{this.plugin.settings.autoSyncOnSave=i,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Configuration"}),t.createEl("p",{text:"Edit publish.config.json in your vault root to customize include/exclude paths and other settings.",cls:"setting-item-description"})}};var c=require("obsidian");var P=require("obsidian"),$=require("child_process"),V=require("util"),Y=(0,V.promisify)($.exec),w=class{constructor(t){this.vaultPath=t}async runGitCommand(t){try{return await Y(t,{cwd:this.vaultPath,maxBuffer:10485760})}catch(e){throw new Error(`Git command failed: ${e.message}
Stderr: ${e.stderr}`)}}async isGitRepository(){try{return await this.runGitCommand("git rev-parse --git-dir"),!0}catch(t){return!1}}async hasRemote(){try{let{stdout:t}=await this.runGitCommand("git remote");return t.trim().length>0}catch(t){return!1}}async getRemoteUrl(){try{let{stdout:t}=await this.runGitCommand("git remote get-url origin");return t.trim()}catch(t){return null}}async hasUncommittedChanges(){try{let{stdout:t}=await this.runGitCommand("git status --porcelain");return t.trim().length>0}catch(t){return!1}}async getBranchName(){try{let{stdout:t}=await this.runGitCommand("git rev-parse --abbrev-ref HEAD");return t.trim()}catch(t){return"main"}}async init(){await this.runGitCommand("git init")}async add(t="-A"){await this.runGitCommand(`git add ${t}`)}async commit(t){let e=t.replace(/"/g,'\\"');await this.runGitCommand(`git commit -m "${e}"`)}async push(){await this.runGitCommand("git push")}async pushWithUpstream(t="main"){await this.runGitCommand(`git push -u origin ${t}`)}async setRemote(t){await this.hasRemote()?await this.runGitCommand(`git remote set-url origin "${t}"`):await this.runGitCommand(`git remote add origin "${t}"`)}async syncAndPush(t){if(!await this.isGitRepository())throw new Error("Not a git repository. Please initialize git first.");if(!await this.hasRemote())throw new Error("No git remote configured. Please add a remote first.");if(await this.add(),await this.hasUncommittedChanges()){let n=t||`VaultSite publish: ${new Date().toISOString()}`;await this.commit(n),new P.Notice("Changes committed")}else new P.Notice("No changes to commit");try{await this.push(),new P.Notice("Pushed to GitHub successfully!")}catch(n){if(n.message.includes("upstream")){let a=await this.getBranchName();await this.pushWithUpstream(a),new P.Notice("Pushed to GitHub successfully!")}else throw n}}getGitInstructions(){return["git init","git add -A",'git commit -m "Initial commit"']}getRemoteInstructions(t){return[`git remote add origin ${t}`,"git branch -M main","git push -u origin main"]}};var h=require("obsidian"),m=z(require("path"),1),d=class{constructor(t){this.app=t}async copyDirectory(t,e){let i=this.app.vault.adapter;await i.exists(e)||await i.mkdir(e);let s=await i.list(t);for(let n of s.files){let a=m.basename(n),o=(0,h.normalizePath)(m.join(e,a)),r=await i.read(n);await i.write(o,r)}for(let n of s.folders){let a=m.basename(n),o=(0,h.normalizePath)(m.join(e,a));await this.copyDirectory(n,o)}}async deleteDirectory(t){let e=this.app.vault.adapter;if(!await e.exists(t))return;let i=await e.list(t);for(let s of i.files)await e.remove(s);for(let s of i.folders)await this.deleteDirectory(s);await e.rmdir(t,!1)}async ensureDirectory(t){let e=this.app.vault.adapter,i=(0,h.normalizePath)(t);await e.exists(i)||await e.mkdir(i)}async writeFile(t,e){let i=this.app.vault.adapter,s=(0,h.normalizePath)(t),n=m.dirname(s);await this.ensureDirectory(n),await i.write(s,e)}async readFile(t){return await this.app.vault.adapter.read((0,h.normalizePath)(t))}async fileExists(t){return await this.app.vault.adapter.exists((0,h.normalizePath)(t))}async copyFile(t,e){let i=await this.readFile(t);await this.writeFile(e,i)}getVaultPath(){return this.app.vault.adapter.basePath}isPathExcluded(t,e){let i=(0,h.normalizePath)(t);for(let s of e){let n=(0,h.normalizePath)(s);if(i.startsWith(n)||i.includes("/"+n+"/")||i.includes("/"+n))return!0}return!1}isPathIncluded(t,e){if(e.length===0)return!0;let i=(0,h.normalizePath)(t);for(let s of e){let n=(0,h.normalizePath)(s);if(i.startsWith(n))return!0}return!1}};var R=class extends c.Modal{constructor(e,i){super(e);this.repoUrlInput="";this.plugin=i,this.fsUtil=new d(e),this.gitUtil=new w(this.fsUtil.getVaultPath())}async onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"VaultSite Setup Wizard"}),e.createEl("p",{text:"Follow these steps to set up your VaultSite website.",cls:"setting-item-description"}),await this.renderStep1(e),await this.renderStep2(e),await this.renderStep3(e),await this.renderStep4(e),await this.renderStep5(e)}async renderStep1(e){let i=e.createDiv({cls:"setup-wizard-step"});i.createEl("h3",{text:"1. Initialize Website"}),i.createEl("p",{text:"Create the /site directory with the Next.js website template."}),await this.fsUtil.fileExists("site")?i.createEl("p",{text:"\u2713 Website directory already exists at /site",cls:"vaultsite-success"}):new c.Setting(i).setName("Create Website").setDesc("Initialize the /site directory").addButton(n=>n.setButtonText("Create /site Website").setCta().onClick(async()=>{n.setDisabled(!0);try{await this.plugin.initializeWebsite(),this.onOpen()}catch(a){new c.Notice(`Failed to initialize website: ${a.message}`),n.setDisabled(!1)}}))}async renderStep2(e){let i=e.createDiv({cls:"setup-wizard-step"});if(i.createEl("h3",{text:"2. Git Repository"}),i.createEl("p",{text:"Initialize git to track your vault changes."}),await this.gitUtil.isGitRepository())i.createEl("p",{text:"\u2713 Git repository detected",cls:"vaultsite-success"});else{i.createEl("p",{text:"\u26A0 No git repository found.",cls:"vaultsite-warning"}),i.createEl("p",{text:"Click the button below to automatically set up git (no terminal needed):"}),new c.Setting(i).setName("Initialize Git").setDesc("Set up git for your vault with one click").addButton(r=>r.setButtonText("Initialize Git Automatically").setCta().onClick(async()=>{r.setDisabled(!0);try{await this.gitUtil.init(),new c.Notice("Git initialized!"),await this.gitUtil.add(),new c.Notice("Files staged"),await this.gitUtil.commit("Initial commit - VaultSite setup"),new c.Notice("\u2713 Git repository created successfully!"),this.onOpen()}catch(u){new c.Notice(`Git initialization failed: ${u.message}`),console.error(u),r.setDisabled(!1)}}));let n=i.createEl("details");n.createEl("summary",{text:"Advanced: Manual setup (for terminal users)"}),n.createEl("pre").createEl("code").setText(this.gitUtil.getGitInstructions().join(`
`))}}async renderStep3(e){let i=e.createDiv({cls:"setup-wizard-step"});i.createEl("h3",{text:"3. Create GitHub Repository"}),i.createEl("p",{text:"Create a new GitHub repository for your vault."}),new c.Setting(i).setName("Open GitHub").setDesc("Create a new repository on GitHub").addButton(s=>s.setButtonText("Open GitHub: New Repo").onClick(()=>{window.open("https://github.com/new","_blank")})),i.createEl("p",{text:"After creating the repository, paste the URL here:"}),new c.Setting(i).setName("GitHub Repository URL").setDesc("Format: https://github.com/username/repo").addText(s=>s.setPlaceholder("https://github.com/username/repo").setValue(this.plugin.settings.githubRepoUrl).onChange(async n=>{this.repoUrlInput=n,this.plugin.settings.githubRepoUrl=n,await this.plugin.saveSettings(),this.onOpen()})),this.plugin.settings.githubRepoUrl&&i.createEl("p",{text:`\u2713 Repository URL saved: ${this.plugin.settings.githubRepoUrl}`,cls:"vaultsite-success"})}async renderStep4(e){let i=e.createDiv({cls:"setup-wizard-step"});i.createEl("h3",{text:"4. Push to GitHub"}),i.createEl("p",{text:"Push your vault to the GitHub repository."});let s=await this.gitUtil.isGitRepository(),n=await this.gitUtil.hasRemote();if(!s){i.createEl("p",{text:"\u26A0 Complete Step 2 first",cls:"vaultsite-warning"});return}if(this.plugin.settings.enableGitPublish&&this.plugin.settings.githubRepoUrl?new c.Setting(i).setName("Configure Remote & Push").setDesc("Set up git remote and push to GitHub").addButton(a=>a.setButtonText("Push to GitHub").setCta().onClick(async()=>{a.setDisabled(!0);try{await this.gitUtil.setRemote(this.plugin.settings.githubRepoUrl),new c.Notice("Git remote configured");let o=await this.gitUtil.getBranchName();await this.gitUtil.pushWithUpstream(o),new c.Notice("Pushed to GitHub successfully!"),this.onOpen()}catch(o){new c.Notice(`Push failed: ${o.message}`),console.error(o),a.setDisabled(!1)}})):(i.createEl("p",{text:"Run these commands in your terminal:"}),this.plugin.settings.githubRepoUrl?(i.createEl("pre").createEl("code").setText(this.gitUtil.getRemoteInstructions(this.plugin.settings.githubRepoUrl).join(`
`)),new c.Setting(i).setName("Copy Commands").addButton(r=>r.setButtonText("Copy to Clipboard").onClick(()=>{navigator.clipboard.writeText(this.gitUtil.getRemoteInstructions(this.plugin.settings.githubRepoUrl).join(`
`)),new c.Notice("Commands copied to clipboard")}))):i.createEl("p",{text:"\u26A0 Enter GitHub repo URL in Step 3 first",cls:"vaultsite-warning"})),n){let a=await this.gitUtil.getRemoteUrl();i.createEl("p",{text:`\u2713 Remote configured: ${a}`,cls:"vaultsite-success"})}}async renderStep5(e){let i=e.createDiv({cls:"setup-wizard-step"});i.createEl("h3",{text:"5. Deploy to Vercel"}),i.createEl("p",{text:"Connect your GitHub repository to Vercel for hosting."}),new c.Setting(i).setName("Open Vercel").setDesc("Import your GitHub repository to Vercel").addButton(r=>r.setButtonText("Open Vercel: New Project").onClick(()=>{window.open("https://vercel.com/new","_blank")}));let s=i.createEl("div",{cls:"setup-instructions"});s.createEl("p",{text:"In Vercel:"});let n=s.createEl("ol");n.createEl("li",{text:'Select "Import Git Repository"'}),n.createEl("li",{text:"Choose your GitHub repository"}),n.createEl("li",{text:"Set Root Directory to: site"}),n.createEl("li",{text:"Click Deploy"}),i.createEl("p",{text:"After deployment, paste your website URL here:"}),new c.Setting(i).setName("Deployed Website URL").setDesc("Format: https://yoursite.vercel.app").addText(r=>r.setPlaceholder("https://yoursite.vercel.app").setValue(this.plugin.settings.deployedUrl).onChange(async u=>{this.plugin.settings.deployedUrl=u,await this.plugin.saveSettings()})),this.plugin.settings.deployedUrl&&(i.createEl("p",{text:`\u2713 Website URL saved: ${this.plugin.settings.deployedUrl}`,cls:"vaultsite-success"}),new c.Setting(i).setName("Open Website").addButton(r=>r.setButtonText("Open Website").setCta().onClick(()=>{window.open(this.plugin.settings.deployedUrl,"_blank")})));let a=await this.fsUtil.fileExists("site"),o=await this.gitUtil.hasRemote();if(a&&o&&this.plugin.settings.deployedUrl){let r=e.createDiv({cls:"setup-wizard-complete"});r.createEl("h3",{text:"\u{1F389} Setup Complete!"}),r.createEl("p",{text:'You can now use the "VaultSite: Publish (Sync + Push)" command to update your website.'})}}onClose(){let{contentEl:e}=this;e.empty()}};var U={include:["notes"],exclude:[".obsidian","site","private","journal"],siteDir:"site",contentDir:"site/content",assetsDir:"site/public/assets",baseRoute:"/notes",slugStyle:"kebab"};var G="publish.config.json",D=class{constructor(t){this.app=t;this.fsUtil=new d(t)}async loadConfig(){try{if(!await this.fsUtil.fileExists(G))return U;let e=await this.fsUtil.readFile(G),i=JSON.parse(e);return{...U,...i}}catch(t){return console.error("Failed to load publish config:",t),U}}async saveConfig(t){let e=JSON.stringify(t,null,2);await this.fsUtil.writeFile(G,e)}async ensureConfigExists(){await this.fsUtil.fileExists(G)||await this.saveConfig(U)}};var b=require("obsidian");var N=class{constructor(t,e){this.config=t;this.allNotePaths=e;this.noteIndex={};this.buildNoteIndex()}buildNoteIndex(){for(let t of this.allNotePaths){let e=t.replace(/\.md$/,""),i=e.split("/"),s=i[i.length-1];s&&(this.noteIndex[s]||(this.noteIndex[s]=[]),this.noteIndex[s].push(e))}}toSlug(t){return this.config.slugStyle==="kebab"?t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):t}resolveWikilink(t){if(t.includes("/")){let s=t.replace(/\.md$/,"");if(s in this.noteIndex||this.allNotePaths.includes(s))return s;let n=s.replace(/\.md$/,"");for(let a of this.allNotePaths)if(a.replace(/\.md$/,"")===n)return n}let e=t.replace(/\.md$/,""),i=this.noteIndex[e];return!i||i.length===0?(console.warn(`Link resolution failed: "${t}" - note not found`),null):(i.length>1&&console.warn(`Link resolution ambiguous: "${t}" matches multiple notes:`,i),i[0]||null)}rewriteLinks(t){let e=t,i=/\[\[([^\]|]+)(\|([^\]]+))?\]\]/g;e=e.replace(i,(n,a,o,r)=>{let u=a.trim(),v=this.resolveWikilink(u);if(!v)return r||u;let y=`${this.config.baseRoute}/${v}`;return`[${r?r.trim():u}](${y})`});let s=/!\[\[([^\]]+)\]\]/g;return e=e.replace(s,(n,a)=>{let o=a.trim();if(/\.(png|jpg|jpeg|gif|svg|webp)$/i.test(o)){let u=o.split("/").pop();return`![${u}](/assets/${u})`}let r=this.resolveWikilink(o);if(r){let u=`${this.config.baseRoute}/${r}`;return`[${o}](${u})`}return n}),e}};var W=z(require("path"),1),k=class{constructor(t,e){this.app=t;this.config=e;this.fsUtil=new d(t)}async syncNotes(){let t=new b.Notice("Syncing notes...",0);try{let e=this.app.vault.getMarkdownFiles(),i=e.filter(o=>this.shouldSyncFile(o.path));if(i.length===0)return t.hide(),new b.Notice("No notes to sync. Check your include/exclude settings."),{synced:0,skipped:e.length};await this.clearContentDirectory();let s=i.map(o=>o.path),n=new N(this.config,s),a=0;for(let o of i)await this.syncFile(o,n),a++;return t.hide(),new b.Notice(`\u2713 Synced ${a} notes to ${this.config.contentDir}`),{synced:a,skipped:e.length-a}}catch(e){throw t.hide(),console.error("Sync error:",e),new b.Notice(`Sync failed: ${e.message}`),e}}shouldSyncFile(t){return this.fsUtil.isPathExcluded(t,this.config.exclude)?!1:this.config.include.length>0?this.fsUtil.isPathIncluded(t,this.config.include):!0}async clearContentDirectory(){await this.fsUtil.fileExists(this.config.contentDir)&&await this.fsUtil.deleteDirectory(this.config.contentDir),await this.fsUtil.ensureDirectory(this.config.contentDir)}async syncFile(t,e){let i=await this.app.vault.read(t),s=e.rewriteLinks(i),n=W.join(this.config.contentDir,t.path);await this.fsUtil.writeFile(n,s)}async copyAssets(){new b.Notice("Asset copying not yet implemented")}};var f=z(require("path"),1),T=class extends p.Plugin{async onload(){await this.loadSettings(),this.fsUtil=new d(this.app),this.gitUtil=new w(this.fsUtil.getVaultPath()),this.configManager=new D(this.app),this.addCommand({id:"vaultsite-setup-wizard",name:"Setup Wizard",callback:()=>{new R(this.app,this).open()}}),this.addCommand({id:"vaultsite-initialize-website",name:"Initialize Website",callback:async()=>{await this.initializeWebsite()}}),this.addCommand({id:"vaultsite-sync-notes",name:"Sync Notes",callback:async()=>{await this.syncNotes()}}),this.addCommand({id:"vaultsite-publish",name:"Publish (Sync + Push)",callback:async()=>{await this.publish()}}),this.addSettingTab(new C(this.app,this)),console.log("VaultSite plugin loaded")}onunload(){console.log("VaultSite plugin unloaded")}async loadSettings(){this.settings=Object.assign({},F,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async initializeWebsite(){let t=new p.Notice("Initializing website...",0);try{if(await this.fsUtil.fileExists("site")){t.hide(),new p.Notice("Website directory already exists at /site");return}let s=this.app.vault.adapter.basePath,n=this.manifest.dir||".",a=f.join(s,n,"template-next"),o=f.join(s,"site"),r=require("fs"),u=require("fs").promises;if(!r.existsSync(a))throw new Error(`Template directory not found at: ${a}
Please reinstall the plugin.`);console.log("Copying template from:",a),console.log("To:",o);async function v(y,x){if((await u.stat(y)).isDirectory()){await u.mkdir(x,{recursive:!0});let L=await u.readdir(y);for(let S of L){if(S==="node_modules"||S===".next"||S==="out")continue;let A=f.join(y,S),H=f.join(x,S);await v(A,H)}}else await u.copyFile(y,x),console.log("Copied:",f.basename(x))}await v(a,o),await this.configManager.ensureConfigExists(),t.hide(),new p.Notice("\u2713 Website initialized at /site"),new p.Notice('Run "VaultSite: Sync Notes" to add your notes'),console.log("Website initialization complete")}catch(e){t.hide(),console.error("Initialize website error:",e),new p.Notice(`Failed to initialize website: ${e.message}`)}}async syncNotes(){try{if(!await this.fsUtil.fileExists("site")){new p.Notice('Website not initialized. Run "Initialize Website" first.');return}let e=await this.configManager.loadConfig();await new k(this.app,e).syncNotes()}catch(t){console.error("Sync error:",t),new p.Notice(`Sync failed: ${t.message}`)}}async publish(){let t=new p.Notice("Publishing...",0);try{if(!await this.fsUtil.fileExists("site")){t.hide(),new p.Notice('Website not initialized. Run "Initialize Website" first.');return}if(await this.syncNotes(),!this.settings.enableGitPublish){t.hide(),new p.Notice("Sync complete. Enable Git Publish in settings to push to GitHub.");return}if(!await this.gitUtil.isGitRepository()){t.hide(),new p.Notice("Not a git repository. Run the Setup Wizard to configure git.");return}if(!await this.gitUtil.hasRemote()){t.hide(),new p.Notice("No git remote configured. Run the Setup Wizard to add a remote.");return}t.setMessage("Pushing to GitHub..."),await this.gitUtil.syncAndPush(),t.hide(),new p.Notice("\u2713 Published! Vercel will deploy automatically."),this.settings.deployedUrl&&new p.Notice("Your site will be updated at: "+this.settings.deployedUrl)}catch(e){t.hide(),console.error("Publish error:",e),new p.Notice(`Publish failed: ${e.message}`)}}};
